(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{190:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h2",{attrs:{id:"etag优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etag优化","aria-hidden":"true"}},[s._v("#")]),s._v(" ETag优化")]),a("p",[s._v("什么是ETag？\n　　实体标签(EntityTag)是唯一标识了一个组件的一个特定版本的字符串，是web服务器用于确认缓存组件的有效性的一种机制，通常可以使用组件的某些属性来构造它。")]),a("p",[s._v("条件GET请求\n　　浏览器下载组件的时候，会将它们存储到浏览器缓存中。如果需要再次获取相同的组件，浏览器将检查组件的缓存时间，假如已经过期，那么浏览器将发送一个条件GET请求到服务器，服务器判断缓存还有效，则发送一个304响应，告诉浏览器可以重用缓存组件。")]),a("p",[s._v("那么服务器是根据什么判断缓存是否还有效呢?")]),a("p",[s._v("答案有两种方式，一种是前面提到的ETag，另一种是根据最新修改时间。先来看看最新修改时间。")]),a("p",[s._v("最新修改时间\n　　原始服务器通过Last-Modified响应头来返回组件的最新修改时间。")]),a("p",[s._v("以一个实际例子来说明，当我们不带缓存访问www.google.com.hk的时候，我们需要下载google的logo，这时会发送这样一个HTTP请求：")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("Request：\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\n  Host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("google"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hk\n\nResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OK")]),s._v("\n  Last"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Modified"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("Wed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2013")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GMT")]),s._v("\n\n")])])]),a("p",[s._v("当需要再次访问相同组件的时候，同时缓存已经过期，浏览器会发送如下条件GET请求：")]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("Request：\n　　"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\n　　If"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Modified"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Since"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("Wed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("09")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2013")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GMT")]),s._v("\n　　Host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("google"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hk\n\nResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n　　"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("304")]),s._v(" Not Modified\n")])])]),a("p",[s._v("实体标签\n　　ETag提供了另外一种方式，用于检测浏览器缓存中的组件与原始服务器上的组件是否匹配。")]),a("p",[s._v("摘抄自书上的例子：")]),a("ol",[a("li",[s._v("不带缓存的请求：")])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("Request：\n　　"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yahoo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gif "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\n　　Host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" us"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yimg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n\nResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n　　"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OK")]),s._v("\n　　Last"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Modified"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("Tue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200603")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GMT")]),s._v("\n　　ETag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("”"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("c24bc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("ab"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("457")]),s._v("elc1f“\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("再次请求相同组件:")])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("Request：\n　　"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yahoo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gif "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v("\n　　Host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" us"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yimg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n　　If"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Modified"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Since"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("Tue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200603")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GMT")]),s._v("\n　　If"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("None"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Match"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("”"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("c24bc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("ab"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("457")]),s._v("elc1f“\n\nResponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n　　"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("HTTP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("304")]),s._v(" Not Midified\n")])])]),a("p",[s._v("当ETag和Modified-Time都出现了，则原始服务器禁止返回304，除非请求中的条件头字段全部一致。")]),a("p",[s._v("为什么要引入ETag?\n　　ETag主要是为了解决Last-Modified无法解决的一些问题：")]),a("p",[s._v("1、一些文件也许会周期性的更改，但是他的内容并不改变(仅仅改变的修改时间)，这个时候我们并不希望客户端认为这个文件被修改了，而重新GET;")]),a("p",[s._v("2、 某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说1s内修改了N次)，If-Modified-Since能检查到的粒度是s级的，这种修改无法判断(或者说UNIX记录MTIME只能精确到秒);")]),a("p",[s._v("3、某些服务器不能精确的得到文件的最后修改时间。")]),a("p",[s._v("ETag带来的问题\n　　ETag的问题在于通常使用某些属性来构造它，有些属性对于特定的部署了网站的服务器来说是唯一的。")]),a("p",[s._v("当使用集群服务器的时候，浏览器从一台服务器上获取了原始组件，之后又向另外一台不同的服务器发起条件GET请求，ETag就会出现不匹配的状况。")]),a("p",[s._v("最佳实践\n　　1、如果使用Last-Modified不会出现任何问题，可以直接移除ETag，google的搜索首页则没有使用ETag。")]),a("p",[s._v("2、确定要使用ETag，在配置ETag的值的时候，移除可能影响到组件集群服务器验证的属性，例如只包含组件大小和时间戳。")])])}],!1,null,null,null);t.default=e.exports}}]);