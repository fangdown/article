(window.webpackJsonp=window.webpackJsonp||[]).push([[145],{381:function(o,t,e){"use strict";e.r(t);var i=e(0),c=Object(i.a)({},function(){var o=this.$createElement;this._self._c;return this._m(0)},[function(){var o=this,t=o.$createElement,e=o._self._c||t;return e("div",{staticClass:"content"},[e("h2",{attrs:{id:"多域名静态资源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#多域名静态资源","aria-hidden":"true"}},[o._v("#")]),o._v(" 多域名静态资源")]),e("blockquote",[e("p",[o._v("网站的静态资源为什么要使用独立域名")])]),e("p",[o._v("在大型网站中，我们发现页面资源经常使用不同的域名进行引用，例如126邮箱的部分js、css、图片存放于http://mimg.127.net/域名下，京东的部分静态图片存放在http://img11.360buyimg.com域名下，那这样做究竟有什么好处呢，和性能又有什么关系呢，下面进行具体分析。")]),e("p",[o._v("一、浏览器并发请求数的限制")]),e("p",[o._v("我们进行网站页面访问时的客户端是浏览器，浏览器的很多机制对网站的访问速度有很大的影响（例如浏览器对静态资源的缓存机制），此外浏览器为提升页面显示效率，支持并发获取资源，但是同一时间针对同一域名下的请求有一定数量限制，超过限制数目的请求会被阻塞。大多数浏览器的并发数量都控制在6以内。有些资源的请求时间很长，因而会阻塞其他资源的请求。因此，对于一些静态资源，如果放到不同的域名下面就能实现与其他资源的并发请求。")]),e("p",[o._v("此外，浏览器对并发请求的数目限制是针对域名的，即针对同一域名（包括二级域名）在同一时间支持的并发请求数量的限制。如果请求数目超出限制，则会阻塞。因此，网站中对一些静态资源，使用不同的一级域名，可以提升浏览器并行请求的数目，加速界面资源的获取速度。")]),e("p",[o._v("因而后来衍生了domain dash来加大并发数，但是过多的域名会使DNS解析负担加重，因此一般控制在2-4个。")]),e("p",[o._v("对于图片资源的加载，利用css sprites技术，结合background的定位在同一张图片中加载多个图片，这也是减少并发数量的一种常用方法。")]),e("p",[o._v("二、网络请求时cookie传输")]),e("p",[o._v("当静态资源与主服务在同一域名下（根据业务需要，主服务请求时需要传递cookie信息），每次静态资源的请求，都会发送同域名下的cookie。而对于静态资源，服务器无需对cookie进行任何处理，它们只是在毫无意义的消耗带宽。")]),e("p",[o._v("假设网站cookie信息有1 KB、网站首页共150个资源时，用户在请求过程中需要发送150 KB的cookie信息，在512 Kbps的常见上行带宽下，需要长达3秒左右才能全部发送完毕。很多情况下cookie的path是在整个一级域名下可用的，如果你把静态资源设置成二级域名，那么它也避免不了cookie。例如如果给 http://126.com 设置了cookie，那么会感染所有子域名, 请求 http://www.126.com/logo.gif或者http://image.126.com/logo.gif 时便会带上讨厌的cookie。")]),e("p",[o._v("所以对于静态资源使用单独的域名，并设置为无cookie，以减少请求大小，提高网页性能。")]),e("p",[o._v("三、方便分流或缓存")]),e("p",[o._v("我们知道，当面对大并发访问时，在服务端会有相应的缓存机制，例如我们会在CDN中缓存一些静态资源，以便用户可以通过就近的网络节点获取资源。例如新浪微博在加载资源时，很多就放在了阿里的CDN上。")]),e("p",[o._v("此外，独立的域名也方便我们在代理服务层做动静分离，以便提升静态请求的处理速度。")]),e("p",[o._v("CDN缓存：CDN是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容发布、调度等功能模块，是用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要是内容存储和分布技术。简单来说，CDN主要用来使用户就近获取资源。")])])}],!1,null,null,null);t.default=c.exports}}]);