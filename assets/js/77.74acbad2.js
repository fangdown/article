(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{292:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h2",{attrs:{id:"svg形状变形问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#svg形状变形问题","aria-hidden":"true"}},[s._v("#")]),s._v(" svg形状变形问题")]),a("ol",[a("li",[a("p",[s._v("现状\n图片文字等这些元素在生成海报的时候，没有问题，svg格式的形状在截取的时候出现残缺，不全")])]),a("li",[a("p",[s._v("分析")])])]),a("ul",[a("li",[s._v("项目中逻辑复杂，嵌套较深，发现及调试问题都比较困难")]),a("li",[s._v("个人喜欢用简单demo最大程度上去验证可行性")]),a("li",[s._v("分析原因\n"),a("ul",[a("li",[s._v("是不是html2canvas组件对svg支持不好呢")]),a("li",[s._v("经过一番搜索后也有人提出该问题，使用cansvg解决这个问题，先把svg转成canvas，然后再截图")])])])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("解决")])]),a("ul",[a("li",[s._v("按照分析的思路，在onbeforeRender中处理")])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("onBeforeRender")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTMLElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("transform "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'none'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 因shape-cmp造成样式不全，去掉该样式")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" svgElements "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("querySelectorAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'svg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    svgElements"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("ele")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 转成canvas，替换svg")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("ul",[a("li",[s._v("经过这样处理以后，形状不残缺了， 完整了，高兴一下")]),a("li",[s._v("继续往下，在产品及测试的摧残中，觉得这个形状变模糊了，变粗变细变形等，瑕疵有不少，继续优化")]),a("li",[s._v("在没有更好思路的情况下，在本地模拟系统数据\n"),a("ul",[a("li",[s._v("拿到页面html结构")]),a("li",[s._v("删除无关内容，保留相关dom结构")]),a("li",[s._v("模拟关键js流程，外置cdnjs等，无法import")])])]),a("li",[s._v("本地深入优化\n"),a("ul",[a("li",[s._v("经过搭建之后，运行页面， 发现svg格式在不用转canvas的情况下，也是可以完整的截图，而且没有瑕疵")]),a("li",[s._v("得到这点验证，觉得哪里写的有问题， 继续向系统环境靠近，把页面中的js、css都拿过来")]),a("li",[s._v("发现生成的canvas有一闪而过（先完整后残缺）的动画， 之后的效果和系统中残缺的效果一致，看来问题发生在js和css中")]),a("li",[s._v("删除js和css验证，其中经过react构建的css太多，采用分段删除，提高效率和准确率，最终找到因一个css样式引起的这个动画效果")]),a("li",[s._v("经过反复对这个css的删除和添加，确定原因，在系统中查找这个css的产生原因，最后修复")]),a("li",[s._v("排除原因后， 再由系统生成形状海报，没有出现残缺了，有个粗细问题，产生的原因也是css有个属性overflow:visible,该属性的意思是内容不会裁剪，会出现在元素之外，加了这个属性就变粗了， 去掉之后就和原本形状一样了，")]),a("li",[s._v("问题都搞定")])]),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[s._v(".shape-cmp{\n  overflow:visible\n}\n\n")])])])])])])}],!1,null,null,null);t.default=e.exports}}]);